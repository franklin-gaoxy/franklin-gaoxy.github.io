查看那些进程占用挂载点
```shell
sudo lsof +D /mnt/mydisk
```
查看路由
```shell
ip route show
```
初始化启动hive
```
schematool -dbType mysql -initSchema
alter table hive_metadata.COLUMNS_V2 modify column COMMENT varchar(256) character set utf8;
alter table hive_metadata.TABLE_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;
alter table hive_metadata.PARTITION_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;
alter table hive_metadata.PARTITION_KEYS modify column PKEY_COMMENT varchar(4000) character set utf8;
alter table hive_metadata.INDEX_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;
nohup hive --service metastore  1>/dev/null  2>&1  &
nohup hive --service hiveserver2 1>/dev/null  2>&1  &
```

免秘钥

```
ssh-keygen -t dsa -P '' -f ~/.ssh/id_dsa
cat ~/.ssh/id_dsa.pub >> ~/.ssh/authorized_keys
chmod 0600 ~/.ssh/authorized_keys
chmod 0700 ~/.ssh

sshpass -p0nIv7uZy38PXENDgtLga+3/Ba7Sfx+bw  ssh-copy-id -i /root/.ssh/id_dsa.pub "-o StrictHostKeyChecking=no"  root@h1
sshpass -p#u]72rs@[s  ssh-copy-id -i /root/.ssh/id_dsa.pub "-o StrictHostKeyChecking=no"  root@h1
```
> debian 11系统 不知道为什么 使用id_dsa密钥链接需要输入密码
> 但是直接使用 ssh-keygen 生成的rsa密钥则不需要

连接优化

```shell
sed -i 's/#UseDNS yes/UseDNS no/g' /etc/ssh/sshd_config
sed -i 's/GSSAPIAuthentication yes/GSSAPIAuthentication no/g' /etc/ssh/sshd_config
systemctl restart sshd
```

prometheus节点监控

```
cd /usr/local/;
curl -o node_export.tar.gz -u admin:1234.com  https://resource.smartone.net.cn/prometheus/node_exporter-0.17.0.linux-amd64.tar.gz ;
tar xf node_export.tar.gz ;
rm -rf node_export.tar.gz ;
mv node_exporter-0.17.0.linux-amd64/ node_exporter ;
cd node_exporter/;nohup ./node_exporter &
```

prometheus 其他组件

```shell
cd /usr/local
wget -q https://resource.smartone.net.cn/prometheus/alertmanager-0.21.0.linux-amd64.tar.gz --http-user=admin --http-password=1234.com
wget -q https://resource.smartone.net.cn/prometheus/blackbox_exporter-0.17.0.linux-amd64.tar.gz --http-user=admin --http-password=1234.com
wget -q https://resource.smartone.net.cn/prometheus/prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz --http-user=admin --http-password=1234.com
tar xf alertmanager-0.21.0.linux-amd64.tar.gz
tar xf blackbox_exporter-0.17.0.linux-amd64.tar.gz
tar xf prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz
rm -rf alertmanager-0.21.0.linux-amd64.tar.gz
rm -rf prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz
rm -rf blackbox_exporter-0.17.0.linux-amd64.tar.gz
cd /usr/local/alertmanager-0.21.0.linux-amd64/
nohup ./alertmanager --config.file=alertmanager.yml &
cd /usr/local/blackbox_exporter-0.17.0.linux-amd64/
nohup ./blackbox_exporter --config.file=blackbox.yml &
cd /usr/local/prometheus-webhook-dingtalk-1.4.0.linux-amd64/
```

添加私有仓库和阿里云

```
cp -rf /usr/lib/systemd/system/docker.service /usr/lib/systemd/system/docker.service.bak
sed -i '/^ExecStart/s/$/ --insecure-registry 124.239.180.93:5000/' /usr/lib/systemd/system/docker.service
mkdir /etc/docker
echo "{\"registry-mirrors\": [\"https://fi5svsbh.mirror.aliyuncs.com\"],\"graph\": \"/data/docker\"}" > /etc/docker/daemon.json
systemctl daemon-reload
systemctl restart docker
```

k8s添加私有仓库

```
kubectl create secret docker-registry docker-registry --docker-server=harbor.smartone.net.cn --docker-username=admin --docker-password=Sinobase@123 -n so-server
```

启动docker

```
# 加参数-tdi --privileged ，启动命令用 init
docker run -tdi --privileged centos init
```

centos切换阿里源

```
mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.backup
mv /etc/yum.repos.d/epel-testing.repo /etc/yum.repos.d/epel-testing.repo.backup
wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
```

切换本地源

```
echo '[localhost]
name = localyum
baseurl = https://admin:1234.com@resource.smartone.net.cn/file/yum/
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
gpgcheck = 0
priority=1' >/etc/yum.repos.d/local.repo
```

安装docker

```
 yum install docker-ce -y
 cp -rf /usr/lib/systemd/system/docker.service /usr/lib/systemd/system/docker.service.bak
 sed -i '/^ExecStart/s/$/ --insecure-registry 124.239.180.93:5000/' /usr/lib/systemd/system/docker.service
 mkdir /etc/docker
 echo "{\"registry-mirrors\": [\"https://fi5svsbh.mirror.aliyuncs.com\"],\"graph\": \"/data/docker\"}" > /etc/docker/daemon.json
 systemctl daemon-reload
 systemctl restart docker
 docker run -d -p 8080:8080 --restart=always -v /data/rancher/db:/var/lib/mysql --name rancher-server registry.cn-hangzhou.aliyuncs.com/sinobasedm/rancher-server:1.6.14
```

安装Java

```shell
curl -O https://devops-sinobase.oss-cn-beijing.aliyuncs.com/%E9%A1%B9%E7%9B%AE/jdk-8u181-linux-x64.tar.gz
tar xf jdk-8u181-linux-x64.tar.gz -C ~/
mv ~/jdk1.8.0_181/ ~/java
echo 'export JAVA_HOME=~/java
export PATH=${PATH}:${JAVA_HOME}/bin' >>~/.bashrc
source ~/.bashrc
```

安装scp

```shell
apt-get update 
apt-get install openssh-client
```

shell 解析json

```
# jq ".字段"
head -n 1 production_json.log|jq ".mem_mallocs"
```

查看进程详细信息

```
top -c
```

获取服务的编排文件

```
kubectl -n mip get pod/system-front-deployment-585cb98798-p778k -o yaml --export
```
永久关闭selinux
```shell
sudo grubby --update-kernel=ALL --args=selinux=0
```
