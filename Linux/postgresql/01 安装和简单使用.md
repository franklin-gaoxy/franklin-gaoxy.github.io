# 安装

## Debian 12 postgresql安装

```shell
apt-get install wget curl vim sudo gnupg gnupg2 lsb-release -y
sudo sh -c 'echo "deb https://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
apt-get update
apt-get -y install postgresql
# apt-get -y install postgresql-16
```

# 简单使用

## 连接

### 修改配置

`vim /etc/postgresql/16/main/pg_hba.conf` 这里的16为版本,结尾添加:

```shell
host    all      all    0.0.0.0/0        md5
```

> all 表示所有数据库
> 
> all 表示所有用户
> 
> 0.0.0.0/0 表示允许所有地址
> 
> md5 表示使用md5来验证
> 
> 如果需要设置规则,参考:
> 
> ```
> # TYPE  DATABASE        USER            ADDRESS                 METHOD
> host    mydatabase      myremoteuser    192.168.1.100/32        md5
> ```

`vi /etc/postgresql/16/main/postgresql.conf`

```shell
# 修改监听地址为所有
listen_addresses = '*'
```

重启服务

```shell
sudo systemctl restart postgresql
```

### 创建用户

```shell
sudo -i -u postgres
# 命令行创建数据库
createdb mydb
# 交互式命令行
psql
# 创建一个用户
CREATE USER test WITH PASSWORD '1qaz@WSX';
# 授权 
GRANT ALL PRIVILEGES ON DATABASE mydb TO test;
# 将用户设置为数据库的所有者
ALTER DATABASE mydb OWNER TO test;
# 列出所有数据库
\l
# 指定数据库
psql -s mydb
# 退出
\q
```

授权

```sql
CREATE ROLE dbmanager;
GRANT ALL PRIVILEGES ON DATABASE mydb TO dbmanager;
-- 授予当前所有模式的所有表权限
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO dbmanager;

-- 授予对当前所有模式的所有序列的权限
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO dbmanager;

-- 授予对当前所有模式的所有函数的权限
GRANT ALL PRIVILEGES ON ALL FUNCTIONS IN SCHEMA public TO dbmanager;

-- 为将来创建的表、序列和函数设置默认权限
ALTER DEFAULT PRIVILEGES IN SCHEMA public
GRANT ALL PRIVILEGES ON TABLES TO dbmanager;
ALTER DEFAULT PRIVILEGES IN SCHEMA public
GRANT ALL PRIVILEGES ON SEQUENCES TO dbmanager;
ALTER DEFAULT PRIVILEGES IN SCHEMA public
GRANT ALL PRIVILEGES ON FUNCTIONS TO dbmanager;

GRANT dbmanager TO test;
```

# 相关文档

[PostgreSQL 中文直译](http://www.postgres.cn/docs/12/)

[PostgreSQL中文社区](http://www.postgres.cn/v2/home)

[PostgreSQL: Documentation: 16: PostgreSQL 16.2 Documentation](https://www.postgresql.org/docs/current/)
